<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Аптека с доставкой</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/stylesheet.css">
</head>
<body>
    <!-- Навигация -->
    <nav class="navbar navbar-expand-lg navbar-light sticky-top">
        <div class="container">
            <a class="navbar-brand logo" href="index.html">
                <i class="fas fa-prescription-bottle-alt me-2"></i>Аптека24
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="index.html">Главная</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="products.html">Товары</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="profile.html">Личный кабинет</a>
                    </li>
                </ul>
                <div class="d-flex" id="authButtons">
                    <button class="btn btn-outline-primary me-2" data-bs-toggle="modal" data-bs-target="#loginModal">Войти</button>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#registerModal">Регистрация</button>
                </div>
                <div class="d-flex d-none" id="userMenu">
                    <a href="cart.html" class="btn btn-outline-primary me-2 position-relative">
                        <i class="fas fa-shopping-cart"></i> Корзина
                        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" id="cartCount">0</span>
                    </a>
                    <a href="profile.html" class="btn btn-outline-primary me-2">
                        <i class="fas fa-user"></i> Профиль
                    </a>
                    <button class="btn btn-outline-primary" id="logoutBtn">Выйти</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Герой секция -->
    <section class="hero-section">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <h1 class="display-5 fw-bold">Аптека с доставкой на дом</h1>
                    <p class="lead">Лекарства, медицинские товары и средства гигиены с быстрой доставкой по городу</p>
                    <div class="mt-4 search-box">
                        <div class="d-flex align-items-center">
                            <input type="text" class="flex-grow-1" placeholder="Найти лекарство...">
                            <button type="button"><i class="fas fa-search"></i></button>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 text-center">
                    <img src="https://cdn-icons-png.flaticon.com/512/2968/2968828.png" alt="Аптека" class="img-fluid" style="max-height: 300px;">
                </div>
            </div>
        </div>
    </section>

    <!-- Категории -->
    <section class="categories mb-5">
        <div class="container">
            <h2 class="text-center mb-4">Популярные категории</h2>
            <div class="row g-4">
                <div class="col-md-3 col-sm-6">
                    <div class="category-card">
                        <div class="category-icon">
                            <i class="fas fa-pills"></i>
                        </div>
                        <h5>Лекарства</h5>
                        <p class="text-muted">Широкий выбор лекарственных средств</p>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6">
                    <div class="category-card">
                        <div class="category-icon">
                            <i class="fas fa-baby"></i>
                        </div>
                        <h5>Детские товары</h5>
                        <p class="text-muted">Все для здоровья вашего ребенка</p>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6">
                    <div class="category-card">
                        <div class="category-icon">
                            <i class="fas fa-heartbeat"></i>
                        </div>
                        <h5>Витамины</h5>
                        <p class="text-muted">Витамины и БАДы для поддержания здоровья</p>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6">
                    <div class="category-card">
                        <div class="category-icon">
                            <i class="fas fa-band-aid"></i>
                        </div>
                        <h5>Медтехника</h5>
                        <p class="text-muted">Тонометры, глюкометры и другая техника</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Популярные товары -->
    <section class="featured-products mb-5">
        <div class="container">
            <h2 class="text-center mb-4">Популярные товары</h2>
            <div class="row g-4">
                <div class="col-lg-3 col-md-4 col-sm-6">
                    <div class="product-card">
                        <div class="product-img">
                            <img src="https://cdn-icons-png.flaticon.com/512/2969/2969626.png" alt="Нурофен" class="img-fluid" style="max-height: 140px;">
                        </div>
                        <div class="p-3">
                            <h5>Нурофен</h5>
                            <p class="text-muted small">Жаропонижающее средство</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="product-price">500 ₽</span>
                                <button class="btn btn-sm btn-outline-primary">В корзину</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-4 col-sm-6">
                    <div class="product-card">
                        <div class="product-img">
                            <img src="https://cdn-icons-png.flaticon.com/512/2969/2969626.png" alt="Ибупрофен" class="img-fluid" style="max-height: 140px;">
                        </div>
                        <div class="p-3">
                            <h5>Ибупрофен</h5>
                            <p class="text-muted small">Обезболивающее средство</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="product-price">350 ₽</span>
                                <button class="btn btn-sm btn-outline-primary">В корзину</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-4 col-sm-6">
                    <div class="product-card">
                        <div class="product-img">
                            <img src="https://cdn-icons-png.flaticon.com/512/2969/2969626.png" alt="Парацетамол" class="img-fluid" style="max-height: 140px;">
                        </div>
                        <div class="p-3">
                            <h5>Парацетамол</h5>
                            <p class="text-muted small">Жаропонижающее средство</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="product-price">280 ₽</span>
                                <button class="btn btn-sm btn-outline-primary">В корзину</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-4 col-sm-6">
                    <div class="product-card">
                        <div class="product-img">
                            <img src="https://cdn-icons-png.flaticon.com/512/2969/2969626.png" alt="Аспирин" class="img-fluid" style="max-height: 140px;">
                        </div>
                        <div class="p-3">
                            <h5>Аспирин</h5>
                            <p class="text-muted small">Противовоспалительное средство</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="product-price">320 ₽</span>
                                <button class="btn btn-sm btn-outline-primary">В корзину</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="text-center mt-4">
                <a href="products.html" class="btn btn-primary">Смотреть все товары</a>
            </div>
        </div>
    </section>

    <!-- Преимущества -->
    <section class="benefits mb-5">
        <div class="container">
            <div class="row g-4">
                <div class="col-md-4 text-center">
                    <div class="p-4">
                        <i class="fas fa-shipping-fast fa-3x text-primary mb-3"></i>
                        <h5>Быстрая доставка</h5>
                        <p class="text-muted">Доставка в течение 2 часов по городу</p>
                    </div>
                </div>
                <div class="col-md-4 text-center">
                    <div class="p-4">
                        <i class="fas fa-check-circle fa-3x text-primary mb-3"></i>
                        <h5>Гарантия качества</h5>
                        <p class="text-muted">Все товары сертифицированы</p>
                    </div>
                </div>
                <div class="col-md-4 text-center">
                    <div class="p-4">
                        <i class="fas fa-headset fa-3x text-primary mb-3"></i>
                        <h5>Круглосуточная поддержка</h5>
                        <p class="text-muted">Консультация фармацевта 24/7</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Футер -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-md-4">
                    <h5 class="logo mb-3"><i class="fas fa-prescription-bottle-alt me-2"></i>Аптека24</h5>
                    <p>Аптека с доставкой на дом. Лекарства, медицинские товары и средства гигиены.</p>
                </div>
                <div class="col-md-4">
                    <h5>Контакты</h5>
                    <p><i class="fas fa-phone me-2"></i> 8 (495) 000-00-01</p>
                    <p><i class="fas fa-envelope me-2"></i> info@apteka24.ru</p>
                    <p><i class="fas fa-map-marker-alt me-2"></i> г. Рязань, ул. Циолковского, 5к1</p>
                </div>
                <div class="col-md-4">
                    <h5>Часы работы</h5>
                    <p>Пн-Пт: 8:00 - 22:00</p>
                    <p>Сб-Вс: 9:00 - 21:00</p>
                    <p>Доставка: круглосуточно</p>
                </div>
            </div>
            <hr class="my-4">
            <div class="text-center">
                <p>&copy; 2023 Аптека24. Все права защищены.</p>
            </div>
        </div>
    </footer>

    <!-- Модальное окно авторизации -->
    <div class="modal fade" id="loginModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Вход в личный кабинет</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="loginForm">
                        <div class="mb-3">
                            <label for="loginPhone" class="form-label">Номер телефона</label>
                            <input type="tel" class="form-control" id="loginPhone" placeholder="79998887766" required>
                            <div class="error-message" id="loginPhoneError">Неверный формат номера телефона</div>
                        </div>
                        <div class="mb-3">
                            <label for="loginPassword" class="form-label">Пароль</label>
                            <input type="password" class="form-control" id="loginPassword" required>
                            <div class="error-message" id="loginPasswordError">Заполните обязательные поля</div>
                        </div>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="rememberMe">
                            <label class="form-check-label" for="rememberMe">Запомнить меня</label>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">Войти</button>
                    </form>
                </div>
                <div class="modal-footer justify-content-center">
                    <p>Нет аккаунта? <a href="#" data-bs-toggle="modal" data-bs-target="#registerModal" data-bs-dismiss="modal">Зарегистрируйтесь</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно регистрации -->
    <div class="modal fade" id="registerModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Регистрация</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="registerForm">
                        <div class="mb-3">
                            <label for="registerPhone" class="form-label">Номер телефона</label>
                            <input type="tel" class="form-control" id="registerPhone" placeholder="79998887766" required>
                            <div class="error-message" id="registerPhoneError">Неверный формат номера телефона</div>
                        </div>
                        <div class="mb-3">
                            <label for="registerPassword" class="form-label">Пароль</label>
                            <input type="password" class="form-control" id="registerPassword" required>
                            <div class="error-message" id="registerPasswordError">Пароль должен содержать не менее 8 символов, включая цифры и буквы</div>
                        </div>
                        <div class="mb-3">
                            <label for="confirmPassword" class="form-label">Подтверждение пароля</label>
                            <input type="password" class="form-control" id="confirmPassword" required>
                            <div class="error-message" id="confirmPasswordError">Пароли не совпадают</div>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">Зарегистрироваться</button>
                    </form>
                </div>
                <div class="modal-footer justify-content-center">
                    <p>Уже есть аккаунт? <a href="#" data-bs-toggle="modal" data-bs-target="#loginModal" data-bs-dismiss="modal">Войдите</a></p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const API_BASE = 'http://localhost:8080/api';
        let currentUser = null;

        // Проверка авторизации при загрузке
        document.addEventListener('DOMContentLoaded', function() {
            checkAuth();
            loadFeaturedProducts();
        });

        // Проверка статуса авторизации
        async function checkAuth() {
            const userData = localStorage.getItem('user');
            if (userData) {
                currentUser = JSON.parse(userData);
                updateNavigation();
                updateCartCount();
            }
        }

        // Обновление навигации
        function updateNavigation() {
            if (currentUser) {
                document.getElementById('authButtons').classList.add('d-none');
                document.getElementById('userMenu').classList.remove('d-none');
            } else {
                document.getElementById('authButtons').classList.remove('d-none');
                document.getElementById('userMenu').classList.add('d-none');
            }
        }

        // Обновление счетчика корзины
        function updateCartCount() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            document.getElementById('cartCount').textContent = cart.length;
        }

        // Загрузка популярных товаров
        async function loadFeaturedProducts() {
            try {
                const response = await fetch(`${API_BASE}/products`);
                const products = await response.json();
                displayFeaturedProducts(products.slice(0, 4));
            } catch (error) {
                console.error('Ошибка загрузки товаров:', error);
            }
        }

        // Отображение популярных товаров
        function displayFeaturedProducts(products) {
            const container = document.getElementById('featuredProducts');
            container.innerHTML = '';

            products.forEach(product => {
                const productCard = `
                    <div class="col-lg-3 col-md-4 col-sm-6">
                        <div class="product-card">
                            <div class="product-img">
                                <i class="fas fa-pills fa-3x text-muted"></i>
                            </div>
                            <div class="p-3">
                                <h5>${product.name}</h5>
                                <p class="text-muted small">${product.description || ''}</p>
                                <div class="d-flex justify-content-between align-items-center">
                                    <span class="product-price">${product.price} ₽</span>
                                    <button class="btn btn-sm btn-outline-primary add-to-cart"
                                            data-product-id="${product.id}">
                                        В корзину
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                container.innerHTML += productCard;
            });

            // Добавляем обработчики для кнопок "В корзину"
            document.querySelectorAll('.add-to-cart').forEach(button => {
                button.addEventListener('click', function() {
                    const productId = this.getAttribute('data-product-id');
                    addToCart(productId, products);
                });
            });
        }

        // Добавление в корзину
        function addToCart(productId, products) {
            const product = products.find(p => p.id == productId);
            if (!product) return;

            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            const existingItem = cart.find(item => item.product.id == productId);

            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({
                    product: product,
                    quantity: 1
                });
            }

            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartCount();
            alert(`Товар "${product.name}" добавлен в корзину`);
        }

        // Обработка формы логина
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const phone = document.getElementById('loginPhone').value;
            const password = document.getElementById('loginPassword').value;

            try {
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ phone, password })
                });

                const data = await response.json();

                if (data.success) {
                    currentUser = data.user;
                    localStorage.setItem('user', JSON.stringify(data.user));
                    updateNavigation();

                    const modal = bootstrap.Modal.getInstance(document.getElementById('loginModal'));
                    modal.hide();

                    alert('Вход выполнен успешно!');
                } else {
                    alert(data.message);
                }
            } catch (error) {
                console.error('Ошибка входа:', error);
                alert('Ошибка при входе в систему');
            }
        });

        // Обработка формы регистрации
        document.getElementById('registerForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const phone = document.getElementById('registerPhone').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if (password !== confirmPassword) {
                alert('Пароли не совпадают');
                return;
            }

            const userData = {
                phone: phone,
                password: password,
                name: ''
            };

            try {
                const response = await fetch(`${API_BASE}/auth/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(userData)
                });

                const data = await response.json();

                if (data.success) {
                    currentUser = data.user;
                    localStorage.setItem('user', JSON.stringify(data.user));
                    updateNavigation();

                    const modal = bootstrap.Modal.getInstance(document.getElementById('registerModal'));
                    modal.hide();

                    alert('Регистрация выполнена успешно!');
                } else {
                    alert(data.message);
                }
            } catch (error) {
                console.error('Ошибка регистрации:', error);
                alert('Ошибка при регистрации');
            }
        });

        // Выход из системы
        document.getElementById('logoutBtn').addEventListener('click', function() {
            localStorage.removeItem('user');
            localStorage.removeItem('cart');
            currentUser = null;
            updateNavigation();
            alert('Вы вышли из системы');
        });
    </script>
</body>
</html>